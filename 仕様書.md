# AIシフト作成システム 設計仕様書

**作成日**: 2025年9月29日  
**バージョン**: 1.0  
**対象**: 居酒屋向けシフト管理・評価システム

---

## 1. システム概要

居酒屋向けのAIを活用したシフト自動作成・スタッフ管理・評価システム。管理者とスタッフの両方の視点から効率的なシフト運用を実現する。

### 1.1 目的

- シフト作成の自動化による管理者の業務負担軽減
- スタッフの希望を最大限考慮した公平なシフト作成
- 客観的な評価システムによる人材育成の促進
- 人件費の可視化と最適化

### 1.2 対象業種

居酒屋(将来的に飲食業全般に拡張可能)

### 1.3 技術スタック

| 分類 | 技術 |
|------|------|
| フロントエンド | Django Templates / HTML / CSS / JavaScript |
| バックエンド | Python / Django |
| データベース | PostgreSQL |
| AI/最適化 | Python(最適化アルゴリズム) |

### 1.4 開発フェーズ

**フェーズ1: MVP (2-3ヶ月)**
- 基本的なシフト作成・管理機能

**フェーズ2: 評価システム (1-2ヶ月)**
- スタッフ評価・フィードバック機能

**フェーズ3: 最適化 (継続)**
- AI精度向上・追加機能開発

---

## 2. 機能一覧

### 2.1 管理者機能

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| A-001 | 店舗基本設定 | 高 | 営業時間、準備時間などの設定 |
| A-002 | 必要人数設定 | 高 | 曜日・時間帯別の必要人数管理 |
| A-003 | スタッフ管理 | 高 | スタッフ情報・スキル・契約管理 |
| A-004 | AIシフト自動生成 | 高 | 制約条件に基づく最適シフト作成 |
| A-005 | シフト手動調整 | 高 | AI生成シフトの編集・調整 |
| A-006 | シフト確定・公開 | 高 | シフト確定とスタッフへの通知 |
| A-007 | 人件費シミュレーション | 中 | シフトごとの人件費計算・表示 |
| A-008 | 評価入力 | 中 | スタッフ評価の入力・管理 |
| A-009 | 勤怠記録閲覧 | 低 | スタッフの出退勤記録確認 |

### 2.2 スタッフ機能

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| S-001 | 希望シフト提出(固定) | 高 | 休み希望・追加勤務希望の提出 |
| S-002 | 希望シフト提出(非固定) | 高 | 勤務可能日時の提出 |
| S-003 | 確定シフト閲覧 | 高 | 自分のシフト確認 |
| S-004 | 評価結果閲覧 | 中 | 自分の評価結果の確認 |
| S-005 | 勤怠記録閲覧 | 低 | 自分の出退勤履歴確認 |

---

## 3. データベース設計

### 3.1 Store(店舗)テーブル

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | Integer | PK | 店舗ID |
| name | Varchar(100) | NOT NULL | 店舗名 |
| opening_time | Time | NOT NULL | 開店時刻 |
| closing_time | Time | NOT NULL | 閉店時刻 |
| preparation_minutes | Integer | DEFAULT 60 | 準備時間(分) |
| cleanup_minutes | Integer | DEFAULT 60 | 片付け時間(分) |

### 3.2 Staff(スタッフ)テーブル

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | Integer | PK | スタッフID |
| user_id | Integer | FK, UNIQUE | ユーザーID |
| store_id | Integer | FK | 店舗ID |
| employment_type | Varchar(20) | NOT NULL | 雇用形態(fixed/flexible) |
| hourly_wage | Integer | NOT NULL | 時給(円) |
| hall_skill_level | Integer | DEFAULT 1 | ホールスキル(1-5) |
| kitchen_skill_level | Integer | DEFAULT 1 | キッチンスキル(1-5) |
| is_manager | Boolean | DEFAULT FALSE | 責任者フラグ |
| max_weekly_hours | Integer | DEFAULT 40 | 週最大労働時間 |

### 3.3 StaffRequirement(必要人数設定)テーブル

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | Integer | PK | 設定ID |
| store_id | Integer | FK | 店舗ID |
| day_of_week | Integer | 0-6 | 曜日(0=月, 6=日) |
| start_time | Time | NOT NULL | 開始時刻 |
| end_time | Time | NOT NULL | 終了時刻 |
| required_staff | Integer | NOT NULL | 必要人数 |
| required_managers | Integer | DEFAULT 1 | 必要責任者数 |
| required_hall_skill | Integer | DEFAULT 0 | 必要ホールスキル人数 |
| required_kitchen_skill | Integer | DEFAULT 0 | 必要キッチンスキル人数 |

### 3.4 Shift(シフト)テーブル

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | Integer | PK | シフトID |
| store_id | Integer | FK | 店舗ID |
| staff_id | Integer | FK | スタッフID |
| date | Date | NOT NULL | 勤務日 |
| start_time | Time | NOT NULL | 開始時刻 |
| end_time | Time | NOT NULL | 終了時刻 |
| is_confirmed | Boolean | DEFAULT FALSE | 確定フラグ |
| created_at | DateTime | AUTO | 作成日時 |

### 3.5 ShiftRequest(希望シフト)テーブル

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | Integer | PK | 希望ID |
| staff_id | Integer | FK | スタッフID |
| date | Date | NOT NULL | 希望日 |
| request_type | Varchar(20) | NOT NULL | 種別(休み/勤務希望) |
| start_time | Time | NULL | 希望開始時刻 |
| end_time | Time | NULL | 希望終了時刻 |
| is_locked | Boolean | DEFAULT FALSE | 編集ロック |
| submitted_at | DateTime | AUTO | 提出日時 |

### 3.6 Evaluation(評価)テーブル

| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | Integer | PK | 評価ID |
| staff_id | Integer | FK | スタッフID |
| evaluator_id | Integer | FK | 評価者ID |
| evaluation_period | Varchar(20) | NOT NULL | 評価期間(2025-09など) |
| attendance_score | Integer | 0-30 | 勤怠スコア |
| skill_score | Integer | 0-40 | 業務スキルスコア |
| teamwork_score | Integer | 0-20 | チームワークスコア |
| customer_service_score | Integer | 0-10 | 顧客対応スコア |
| total_score | Integer | 0-100 | 合計スコア |
| comment | Text | NULL | コメント |
| created_at | DateTime | AUTO | 評価日時 |

---

## 4. 画面設計

### 4.1 管理者画面

#### ダッシュボード
今月のシフト状況、人件費、未確定シフト数の表示

**主要機能**:
- サマリー表示

#### 店舗設定画面
営業時間、準備・片付け時間の設定

**主要機能**:
- 基本情報設定

#### 必要人数設定画面
曜日・時間帯別の必要人数をマトリックス形式で設定

**主要機能**:
- 曜日選択(月~日)
- 時間帯スライダー
- 必要人数・責任者数の入力
- テンプレート機能(平日/週末/繁忙期)

#### スタッフ管理画面
スタッフ一覧、登録、編集、削除

**主要機能**:
- 検索・フィルター機能
- スキルレベル編集
- 時給設定

#### シフト作成画面
AIシフト自動生成と手動調整

**主要機能**:
- 対象期間選択
- AI生成ボタン
- カレンダー形式のシフト表
- ドラッグ&ドロップでの調整
- 人件費リアルタイム表示
- 確定ボタン

#### 評価入力画面
スタッフ評価の入力

**主要機能**:
- 評価対象スタッフ選択
- 評価項目ごとの点数入力
- コメント記入欄
- 過去評価履歴表示

#### 人件費レポート画面
週次・月次の人件費集計

**主要機能**:
- 期間指定
- グラフ表示
- スタッフ別・時間帯別の内訳

### 4.2 スタッフ画面

#### マイページ
今月のシフト、評価スコア、お知らせの表示

**主要機能**:
- ダッシュボード

#### 希望シフト提出画面(固定契約)
休み希望と追加勤務希望の提出

**主要機能**:
- カレンダー形式
- 休み希望日の選択
- 追加勤務希望の日時選択
- 提出期限の表示

#### 希望シフト提出画面(非固定契約)
勤務可能日時の提出

**主要機能**:
- カレンダー形式
- 勤務可能日の選択
- 時間帯の選択
- 提出期限の表示

#### シフト確認画面
確定したシフトの閲覧

**主要機能**:
- 月間カレンダー表示
- 勤務時間・場所の詳細
- 月間勤務時間の集計

#### 評価結果確認画面
自分の評価結果の閲覧

**主要機能**:
- 最新評価の表示
- 項目別スコア
- 評価者コメント
- 過去の評価推移グラフ

### 4.3 共通画面

#### ログイン画面
ユーザー認証

#### パスワード変更画面
セキュリティ設定

---

## 5. ユーザー管理

### 5.1 ユーザー種別と権限

| ユーザー種別 | 権限レベル | 説明 |
|-------------|-----------|------|
| システム管理者 | 最高 | 全機能へのアクセス、システム設定 |
| 店長 | 高 | 店舗管理、シフト作成・確定、評価入力 |
| 副店長 | 中 | シフト調整、評価入力(承認は不可) |
| スタッフ(責任者) | 低 | 希望シフト提出、シフト確認、評価確認 |
| スタッフ(一般) | 低 | 希望シフト提出、シフト確認、評価確認 |

### 5.2 認証・認可

#### 認証方式
- ユーザーID・パスワード認証
- Djangoの認証システムを使用
- パスワードはハッシュ化して保存
- セッション管理(有効期限: 24時間)

#### パスワードポリシー
- 最小8文字以上
- 英数字を含む
- 90日ごとの変更推奨
- 過去3回のパスワードは再利用不可

#### 権限管理
- Djangoのグループ・パーミッション機能を使用
- 役割ベースアクセス制御(RBAC)
- 画面・機能ごとに権限チェック

### 5.3 セキュリティ対策

| 項目 | 内容 |
|------|------|
| ログイン試行制限 | 5回失敗でアカウントロック(30分間) |
| セッションタイムアウト | 24時間で自動ログアウト |
| IPアドレス制限 | 管理者機能は店舗IPからのみアクセス可能(オプション) |

---

## 6. 評価システム詳細

### 6.1 評価項目と配点

#### 1. 勤怠関連(30点)

| 小項目 | 配点 | 評価基準 |
|--------|------|----------|
| 出勤率 | 15点 | 100%=15点、95-99%=12点、90-94%=9点 |
| 遅刻・早退 | 10点 | なし=10点、1回=8点、2回=6点 |
| シフト遵守 | 5点 | 無断欠勤なし=5点、1回=0点 |

#### 2. 業務スキル(40点)

| 小項目 | 配点 | 評価基準 |
|--------|------|----------|
| ホール業務 | 10点 | オーダー取り、配膳、接客、レジ対応 |
| キッチン業務 | 10点 | 調理スピード、盛り付け、衛生管理 |
| 開店・閉店作業 | 10点 | 準備作業、清掃、締め作業の正確性 |
| 責任者業務 | 10点 | スタッフ指導、トラブル対応、売上管理 |

#### 3. チームワーク・態度(20点)

| 小項目 | 配点 | 評価基準 |
|--------|------|----------|
| 協調性 | 7点 | 他スタッフとの連携、サポート姿勢 |
| コミュニケーション | 7点 | 報連相の徹底、積極的な情報共有 |
| 向上心 | 6点 | 新しい業務への挑戦、フィードバック受容 |

#### 4. 顧客対応(10点)

| 小項目 | 配点 | 評価基準 |
|--------|------|----------|
| 接客態度 | 5点 | 笑顔、明るさ、丁寧な言葉遣い |
| クレーム対応 | 5点 | 適切な初期対応、上司への報告 |

### 6.2 評価サイクル

| サイクル | 頻度 | 目的 |
|----------|------|------|
| 月次評価 | 毎月 | 短期的な改善を促進 |
| 四半期評価 | 3ヶ月ごと | 詳細評価を実施 |
| 年次評価 | 年1回 | 昇給・契約更新の判断材料 |

### 6.3 評価プロセス

1. **評価期間の設定**: 管理者が評価対象期間を設定
2. **評価入力**: 直属の責任者と店長・副店長が各項目を評価
3. **スコア計算**: システムが自動的に合計スコアを計算(責任者60%、店長40%の重み付け)
4. **フィードバック面談**: 評価者がスタッフに結果を説明、改善点を伝える
5. **結果の公開**: スタッフがシステムで自分の評価結果を確認可能に

### 6.4 評価の透明性確保

- 評価基準を採用時に全スタッフに明示
- 月1回のフィードバック面談で進捗確認
- 評価結果の点数と改善点を本人に通知
- 異議申し立て制度の設置
- 評価履歴のグラフ化による可視化

---

## 7. セキュリティ設計

### 7.1 データ保護

#### 個人情報の暗号化
- 氏名、連絡先などの個人情報は暗号化して保存
- AES-256による暗号化
- パスワードはbcryptでハッシュ化

#### 通信の暗号化
- HTTPS(TLS 1.3)による通信の暗号化
- SSL証明書導入

#### バックアップ
- 日次自動バックアップ
- バックアップデータは暗号化して保存
- 30日間の世代管理

### 7.2 アクセス制御

| 対策 | 内容 |
|------|------|
| 認証 | ID・パスワード認証、セッション管理 |
| 認可 | 役割ベースアクセス制御(RBAC) |
| ログイン試行制限 | 5回失敗でアカウントロック(30分間) |
| セッションタイムアウト | 24時間で自動ログアウト |
| IPアドレス制限 | 管理者機能は店舗IPからのみアクセス可能(オプション) |

### 7.3 監査とログ

#### 記録する情報
- ログイン・ログアウト履歴
- データの作成・更新・削除操作
- シフトの確定・変更履歴
- 評価の入力・変更履歴
- アクセス権限の変更
- エラー発生履歴

※ログは最低1年間保存し、定期的に監査を実施

### 7.4 脆弱性対策

| 脅威 | 対策 |
|------|------|
| SQLインジェクション | DjangoのORM使用、プリペアドステートメント |
| XSS(クロスサイトスクリプティング) | 入力値のエスケープ、Djangoの自動エスケープ機能 |
| CSRF(クロスサイトリクエストフォージェリ) | DjangoのCSRFトークン機能 |
| セッションハイジャック | HTTPSの強制、セキュアなCookie設定 |
| ブルートフォース攻撃 | ログイン試行回数制限、CAPTCHA導入 |

### 7.5 コンプライアンス

#### 個人情報保護法への対応
- 個人情報の利用目的を明示
- 本人同意の取得
- 第三者提供の制限
- 安全管理措置の実施

#### 労働基準法への対応
- 1日9時間拘束(8時間労働+1時間休憩)の上限設定
- 週40時間労働の上限設定
- 休憩時間の確保
- 労働時間の正確な記録

---

**文書の終わり**